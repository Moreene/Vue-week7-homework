import{a as p}from"./axios-G2rPRu76.js";import{M as $,P as C,_ as T}from"./loading-QN01jws6.js";import{_ as v,o as a,c as i,a as e,t as r,w as u,v as h,j as L,g as y,F as O,i as g,p as U,k as I,h as k,b,d as f,e as P}from"./index-D1836AQy.js";var D={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"moreene",BASE_URL:"/Vue-week7-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:R,VITE_PATH:S}=D,A={props:["tempOrder"],data(){return{order:{},editOrderModal:null}},methods:{updateOrder(){p.put(`${R}/api/${S}/admin/order/${this.tempOrder.id}`,{data:this.order}).then(s=>{this.$swal({icon:"success",title:s.data.message,showConfirmButton:!0}),this.$emit("updateOrder"),this.editOrderModal.hide()}).catch(s=>{this.$swal({icon:"error",title:s.response.data.message,showConfirmButton:!0})})}},watch:{tempOrder(){this.order=this.tempOrder}},mounted(){this.editOrderModal=new $(this.$refs.editOrderModal,{keyboard:!1,backdrop:"static"})}},c=s=>(U("data-v-7be51b02"),s=s(),I(),s),B={id:"editOrderModal",ref:"editOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"editOrderModalLabel","aria-hidden":"true"},H={class:"modal-dialog modal-xl"},N={class:"modal-content border-0"},j={class:"modal-header bg-info text-white"},q={id:"editOrderModalLabel",class:"modal-title"},F=c(()=>e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),z={class:"modal-body"},G={class:"h5 fw-bold"},J={class:"h5 fw-bold"},K={class:"row py-4"},Q={class:"col-lg-6"},W={key:0,class:"row gy-3"},X={class:"col-md-6"},Y=c(()=>e("label",{for:"people",class:"form-label"},"訂購人",-1)),Z={class:"col-md-6"},ee=c(()=>e("label",{for:"phone",class:"form-label"},"手機",-1)),te={class:"col-md-6"},oe=c(()=>e("label",{for:"mail",class:"form-label"},"信箱",-1)),se={class:"col-md-6"},de=c(()=>e("label",{for:"address",class:"form-label"},"地址",-1)),re={class:"col-12"},le=c(()=>e("label",{for:"extarea"},"留言",-1)),ne={class:"col-12"},ae={class:"form-check"},ie=c(()=>e("label",{class:"form-check-label",for:"check"}," 已付款 ",-1)),ce={class:"col-lg-6"},ue={key:0},_e=c(()=>e("hr",{class:"my-2"},null,-1)),he={class:"ps-3 py-2"},pe=c(()=>e("hr",{class:"my-2"},null,-1)),me={class:"modal-footer"},be=c(()=>e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1));function fe(s,t,m,w,o,n){return a(),i("div",B,[e("div",H,[e("div",N,[e("div",j,[e("h5",q,[e("span",null,r(o.order.id),1)]),F]),e("div",z,[e("h2",G,"訂單編號："+r(o.order.id),1),e("h2",J,"訂單日期："+r(new Date(o.order.create_at*1e3).toLocaleDateString()),1),e("div",K,[e("div",Q,[o.order.user?(a(),i("div",W,[e("div",X,[Y,u(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=d=>o.order.user.name=d),disabled:""},null,512),[[h,o.order.user.name]])]),e("div",Z,[ee,u(e("input",{id:"phone",type:"tel",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=d=>o.order.user.tel=d),disabled:""},null,512),[[h,o.order.user.tel]])]),e("div",te,[oe,u(e("input",{id:"mail",type:"email",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=d=>o.order.user.email=d),disabled:""},null,512),[[h,o.order.user.email]])]),e("div",se,[de,u(e("input",{id:"address",type:"text",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=d=>o.order.user.address=d)},null,512),[[h,o.order.user.address]])]),e("div",re,[le,u(e("textarea",{class:"form-control",id:"extarea",style:{height:"100px"},"onUpdate:modelValue":t[4]||(t[4]=d=>o.order.message=d)},null,512),[[h,o.order.message]])]),e("div",ne,[e("div",ae,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=d=>o.order.is_paid=d),id:"check"},null,512),[[L,o.order.is_paid]]),ie])])])):y("",!0)]),e("div",ce,[o.order&&o.order.products?(a(),i("div",ue," 訂購內容 ("+r(Object.keys(o.order.products).length)+") ",1)):y("",!0),_e,e("ol",he,[(a(!0),i(O,null,g(o.order.products,d=>(a(),i("li",{key:d.id},r(d.product.title)+" x "+r(d.qty),1))),128))]),pe,e("p",null,"總金額："+r(o.order.total),1)])]),e("div",me,[be,e("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=(...d)=>n.updateOrder&&n.updateOrder(...d))}," 確認 ")])])])])],512)}const Oe=v(A,[["render",fe],["__scopeId","data-v-7be51b02"]]);var ge={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"moreene",BASE_URL:"/Vue-week7-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:ve,VITE_PATH:we}=ge,ye={props:["tempOrder"],data(){return{delOrderModal:null}},methods:{delProduct(){const s=`${ve}/api/${we}/admin/order/${this.tempOrder.id}`;p.delete(s).then(t=>{this.$swal({icon:"success",title:t.data.message,showConfirmButton:!0}),this.$emit("update"),this.delOrderModal.hide()}).catch(t=>{this.$swal({icon:"error",title:t.response.data.message,showConfirmButton:!0})})}},mounted(){this.delOrderModal=new $(this.$refs.delOrderModal,{keyboard:!1,backdrop:"static"})}},ke={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},Ve={class:"modal-dialog"},$e={class:"modal-content border-0"},Me={class:"modal-header bg-danger text-white"},Ee={id:"delOrderModalLabel",class:"modal-title"},xe=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ce={class:"modal-body"},Te={class:"text-danger"},Le={class:"modal-footer"},Ue=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ie(s,t,m,w,o,n){return a(),i("div",ke,[e("div",Ve,[e("div",$e,[e("div",Me,[e("h5",Ee,[e("span",null,r(m.tempOrder.id),1)]),xe]),e("div",Ce,[k(" 是否要刪除 "),e("strong",Te,r(m.tempOrder.id),1),k(" 訂單? ")]),e("div",Le,[Ue,e("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...d)=>n.delProduct&&n.delProduct(...d))}," 確認刪除 ")])])])],512)}const Pe=v(ye,[["render",Ie]]);var De={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"moreene",BASE_URL:"/Vue-week7-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:V,VITE_PATH:Re}=De,Se={components:{OrderEditComponent:Oe,OrderDelComponent:Pe,PaginationComponent:C},data(){return{isLoading:!0,orders:[],tempOrder:{},pagination:{}}},methods:{checkLogin(){p.post(`${V}/api/user/check`).then(s=>{this.getOrders(),this.isShow=!0}).catch(s=>{this.$swal({icon:"error",title:"您沒有權限進入!",showConfirmButton:!0}),this.$router.push("/")})},getOrders(s=1){p.get(`${V}/api/${Re}/admin/orders?page=${s}`).then(t=>{this.orders=t.data.orders,this.pagination=t.data.pagination,this.isLoading=!1}).catch(t=>{this.$swal({icon:"error",title:t.response.data.message,showConfirmButton:!0})})},openModal(s,t){s==="edit"?(this.tempOrder={...t},this.$refs.editOrderModal.editOrderModal.show()):s==="delete"&&(this.tempOrder={...t},this.$refs.delOrderModal.delOrderModal.show())}},mounted(){const s=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");p.defaults.headers.common.Authorization=s,this.checkLogin()}},Ae=e("img",{src:T,alt:""},null,-1),Be=e("h1",{class:"h3 fw-bold text-center my-5"},"訂單列表",-1),He={class:"container"},Ne={class:"table-responsive"},je={class:"table mt-4"},qe=e("thead",null,[e("tr",{class:"text-nowrap"},[e("th",null," 成立時間 "),e("th",{width:"300"}," 訂單編號 "),e("th",null," 訂購人 "),e("th",null," 手機 "),e("th",null," 訂單內容 "),e("th",null," 合計 "),e("th",null," 付款 "),e("th",null," 編輯 ")])],-1),Fe={class:"text-nowrap"},ze={class:"ps-0 mb-0"},Ge={class:"btn-group"},Je=["onClick"],Ke=["onClick"];function Qe(s,t,m,w,o,n){const d=b("VueLoading"),M=b("PaginationComponent"),E=b("OrderEditComponent"),x=b("OrderDelComponent");return a(),i(O,null,[f(d,{active:o.isLoading,"onUpdate:active":t[0]||(t[0]=l=>o.isLoading=l)},{default:P(()=>[Ae]),_:1},8,["active"]),Be,e("div",He,[e("div",Ne,[e("table",je,[qe,e("tbody",Fe,[(a(!0),i(O,null,g(o.orders,l=>(a(),i("tr",{key:l.id},[e("td",null,r(new Date(l.create_at*1e3).toLocaleDateString()),1),e("td",null,r(l.id),1),e("td",null,r(l.user.name),1),e("td",null,r(l.user.tel),1),e("td",null,[e("td",null,[e("ul",ze,[(a(!0),i(O,null,g(l.products,_=>(a(),i("li",{key:_.product_id},r(_.product.title)+" * "+r(_.qty),1))),128))])])]),e("td",null,r(l.total),1),e("td",null,r(l.is_paid?"已付款":"未付款"),1),e("td",null,[e("div",Ge,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:_=>n.openModal("edit",l)}," 編輯 ",8,Je),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:_=>n.openModal("delete",l)}," 刪除 ",8,Ke)])])]))),128))])])]),f(M,{pagination:o.pagination,onEmitPages:n.getOrders},null,8,["pagination","onEmitPages"]),f(E,{ref:"editOrderModal","temp-order":o.tempOrder,onUpdateOrder:n.getOrders},null,8,["temp-order","onUpdateOrder"]),f(x,{ref:"delOrderModal","temp-order":o.tempOrder,onUpdate:n.getOrders},null,8,["temp-order","onUpdate"])])],64)}const Ze=v(Se,[["render",Qe]]);export{Ze as default};
