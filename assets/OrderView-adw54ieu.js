import{a as p}from"./axios-G2rPRu76.js";import{M as V,P as x,_ as C}from"./loading-yCzHr4de.js";import{_ as v,o as i,c,a as e,t as d,w as _,v as m,j as T,g as L,F as O,i as g,p as U,k as I,h as y,b,d as f,e as P}from"./index-WYS0ByVx.js";var D={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"moreene",BASE_URL:"/Vue-week7-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:R,VITE_PATH:S}=D,A={props:["tempOrder"],data(){return{user:{},editOrderModal:null}},methods:{updateOrder(){p.put(`${R}/api/${S}/admin/order/${this.tempOrder.id}`,{data:this.tempOrder}).then(o=>{this.$swal({icon:"success",title:o.data.message,showConfirmButton:!0}),this.$emit("updateOrder"),this.editOrderModal.hide()}).catch(o=>{this.$swal({icon:"error",title:o.response.data.message,showConfirmButton:!0})})}},watch:{tempOrder(){this.user=this.tempOrder.user}},mounted(){this.editOrderModal=new V(this.$refs.editOrderModal,{keyboard:!1,backdrop:"static"})}},u=o=>(U("data-v-9759d434"),o=o(),I(),o),B={id:"editOrderModal",ref:"editOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"editOrderModalLabel","aria-hidden":"true"},H={class:"modal-dialog modal-xl"},N={class:"modal-content border-0"},j={class:"modal-header bg-info text-white"},q={id:"editOrderModalLabel",class:"modal-title"},F=u(()=>e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),z={class:"modal-body"},G={class:"h5 fw-bold"},J={class:"h5 fw-bold"},K={class:"row py-4"},Q={class:"col-lg-6"},W={class:"row gy-3"},X={class:"col-md-6"},Y=u(()=>e("label",{for:"people",class:"form-label"},"訂購人",-1)),Z={class:"col-md-6"},ee=u(()=>e("label",{for:"phone",class:"form-label"},"手機",-1)),te={class:"col-md-6"},oe=u(()=>e("label",{for:"mail",class:"form-label"},"信箱",-1)),se={class:"col-md-6"},de=u(()=>e("label",{for:"address",class:"form-label"},"地址",-1)),re={class:"col-12"},le=u(()=>e("label",{for:"extarea"},"留言",-1)),ne={class:"col-12"},ae={class:"form-check"},ie=u(()=>e("label",{class:"form-check-label",for:"check"}," 已付款 ",-1)),ce={class:"col-lg-6"},ue={key:0},_e=u(()=>e("hr",{class:"my-2"},null,-1)),he={class:"ps-3 py-2"},me=u(()=>e("hr",{class:"my-2"},null,-1)),pe={class:"modal-footer"},be=u(()=>e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1));function fe(o,t,r,w,l,a){return i(),c("div",B,[e("div",H,[e("div",N,[e("div",j,[e("h5",q,[e("span",null,d(r.tempOrder.id),1)]),F]),e("div",z,[e("h2",G,"訂單編號："+d(r.tempOrder.id),1),e("h2",J,"訂單日期："+d(new Date(r.tempOrder.create_at*1e3).toLocaleDateString()),1),e("div",K,[e("div",Q,[e("div",W,[e("div",X,[Y,_(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=s=>l.user.name=s),disabled:""},null,512),[[m,l.user.name]])]),e("div",Z,[ee,_(e("input",{id:"phone",type:"tel",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=s=>l.user.tel=s),disabled:""},null,512),[[m,l.user.tel]])]),e("div",te,[oe,_(e("input",{id:"mail",type:"email",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=s=>l.user.email=s),disabled:""},null,512),[[m,l.user.email]])]),e("div",se,[de,_(e("input",{id:"address",type:"text",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=s=>l.user.address=s)},null,512),[[m,l.user.address]])]),e("div",re,[le,_(e("textarea",{class:"form-control",id:"extarea",style:{height:"100px"},"onUpdate:modelValue":t[4]||(t[4]=s=>r.tempOrder.message=s)},null,512),[[m,r.tempOrder.message]])]),e("div",ne,[e("div",ae,[_(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=s=>r.tempOrder.is_paid=s),id:"check"},null,512),[[T,r.tempOrder.is_paid]]),ie])])])]),e("div",ce,[r.tempOrder&&r.tempOrder.products?(i(),c("div",ue," 訂購內容 ("+d(Object.keys(r.tempOrder.products).length)+") ",1)):L("",!0),_e,e("ol",he,[(i(!0),c(O,null,g(r.tempOrder.products,s=>(i(),c("li",{key:s.id},d(s.product.title)+" x "+d(s.qty),1))),128))]),me,e("p",null,"總金額："+d(r.tempOrder.total),1)])]),e("div",pe,[be,e("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=(...s)=>a.updateOrder&&a.updateOrder(...s))}," 確認 ")])])])])],512)}const Oe=v(A,[["render",fe],["__scopeId","data-v-9759d434"]]);var ge={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"moreene",BASE_URL:"/Vue-week7-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:ve,VITE_PATH:we}=ge,ye={props:["tempOrder"],data(){return{delOrderModal:null}},methods:{delProduct(){const o=`${ve}/api/${we}/admin/order/${this.tempOrder.id}`;p.delete(o).then(t=>{this.$swal({icon:"success",title:t.data.message,showConfirmButton:!0}),this.$emit("update"),this.delOrderModal.hide()}).catch(t=>{this.$swal({icon:"error",title:t.response.data.message,showConfirmButton:!0})})}},mounted(){this.delOrderModal=new V(this.$refs.delOrderModal,{keyboard:!1,backdrop:"static"})}},ke={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},Ve={class:"modal-dialog"},$e={class:"modal-content border-0"},Me={class:"modal-header bg-danger text-white"},Ee={id:"delOrderModalLabel",class:"modal-title"},xe=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ce={class:"modal-body"},Te={class:"text-danger"},Le={class:"modal-footer"},Ue=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ie(o,t,r,w,l,a){return i(),c("div",ke,[e("div",Ve,[e("div",$e,[e("div",Me,[e("h5",Ee,[e("span",null,d(r.tempOrder.id),1)]),xe]),e("div",Ce,[y(" 是否要刪除 "),e("strong",Te,d(r.tempOrder.id),1),y(" 訂單? ")]),e("div",Le,[Ue,e("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...s)=>a.delProduct&&a.delProduct(...s))}," 確認刪除 ")])])])],512)}const Pe=v(ye,[["render",Ie]]);var De={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"moreene",BASE_URL:"/Vue-week7-homework/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:k,VITE_PATH:Re}=De,Se={components:{OrderEditComponent:Oe,OrderDelComponent:Pe,PaginationComponent:x},data(){return{isLoading:!0,orders:[],tempOrder:{},pagination:{}}},methods:{checkLogin(){p.post(`${k}/api/user/check`).then(o=>{this.getOrders(),this.isShow=!0}).catch(o=>{this.$swal({icon:"error",title:"您沒有權限進入!",showConfirmButton:!0}),this.$router.push("/")})},getOrders(o=1){p.get(`${k}/api/${Re}/admin/orders?page=${o}`).then(t=>{this.orders=t.data.orders,this.pagination=t.data.pagination,this.isLoading=!1}).catch(t=>{this.$swal({icon:"error",title:t.response.data.message,showConfirmButton:!0})})},openModal(o,t){o==="edit"?(this.tempOrder={...t},this.$refs.editOrderModal.editOrderModal.show()):o==="delete"&&(this.tempOrder={...t},this.$refs.delOrderModal.delOrderModal.show())}},mounted(){const o=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");p.defaults.headers.common.Authorization=o,this.checkLogin()}},Ae=e("img",{src:C,alt:""},null,-1),Be=e("h1",{class:"h3 fw-bold text-center my-5"},"訂單列表",-1),He={class:"container"},Ne={class:"table-responsive"},je={class:"table mt-4"},qe=e("thead",null,[e("tr",{class:"text-nowrap"},[e("th",null," 成立時間 "),e("th",{width:"300"}," 訂單編號 "),e("th",null," 訂購人 "),e("th",null," 手機 "),e("th",null," 訂單內容 "),e("th",null," 合計 "),e("th",null," 付款 "),e("th",null," 編輯 ")])],-1),Fe={class:"text-nowrap"},ze={class:"ps-0 mb-0"},Ge={class:"btn-group"},Je=["onClick"],Ke=["onClick"];function Qe(o,t,r,w,l,a){const s=b("VueLoading"),$=b("PaginationComponent"),M=b("OrderEditComponent"),E=b("OrderDelComponent");return i(),c(O,null,[f(s,{active:l.isLoading,"onUpdate:active":t[0]||(t[0]=n=>l.isLoading=n)},{default:P(()=>[Ae]),_:1},8,["active"]),Be,e("div",He,[e("div",Ne,[e("table",je,[qe,e("tbody",Fe,[(i(!0),c(O,null,g(l.orders,n=>(i(),c("tr",{key:n.id},[e("td",null,d(new Date(n.create_at*1e3).toLocaleDateString()),1),e("td",null,d(n.id),1),e("td",null,d(n.user.name),1),e("td",null,d(n.user.tel),1),e("td",null,[e("td",null,[e("ul",ze,[(i(!0),c(O,null,g(n.products,h=>(i(),c("li",{key:h.product_id},d(h.product.title)+" * "+d(h.qty),1))),128))])])]),e("td",null,d(n.total),1),e("td",null,d(n.is_paid?"已付款":"未付款"),1),e("td",null,[e("div",Ge,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:h=>a.openModal("edit",n)}," 編輯 ",8,Je),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:h=>a.openModal("delete",n)}," 刪除 ",8,Ke)])])]))),128))])])]),f($,{pagination:l.pagination,onEmitPages:a.getOrders},null,8,["pagination","onEmitPages"]),f(M,{ref:"editOrderModal","temp-order":l.tempOrder,onUpdateOrder:a.getOrders},null,8,["temp-order","onUpdateOrder"]),f(E,{ref:"delOrderModal","temp-order":l.tempOrder,onUpdate:a.getOrders},null,8,["temp-order","onUpdate"])])],64)}const Ze=v(Se,[["render",Qe]]);export{Ze as default};
